@page
@model PRN222_Restaurant.Pages.FeedbackFullModel
@using PRN222_Restaurant.Models

@{
    ViewData["Title"] = "Tất cả phản hồi";
}

<div class="max-w-5xl mx-auto px-4 py-10">
    <h2 class="text-3xl font-extrabold mb-8 mt-8 text-center text-slate-800">📣 Phản hồi từ khách hàng</h2>

    @if (Model.FeedbackResult == null || !Model.FeedbackResult.Items.Any())
    {
        <p class="text-center text-gray-500 italic">Không có phản hồi nào.</p>
    }
    else
    {
        <div class="space-y-6">
            @foreach (var feedback in Model.FeedbackResult.Items)
            {
                <div class="flex items-start gap-4 p-5 rounded-xl bg-white shadow-md border">
                    <img class="w-14 h-14 rounded-full object-cover border" src="https://i.pravatar.cc/150?u=@feedback.UserId" alt="Avatar" />
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <h6 class="text-lg font-semibold text-slate-900">@feedback.User?.FullName</h6>
                                <p class="text-sm text-gray-500">@feedback.User?.Email</p>
                            </div>
                            <p class="text-sm text-gray-400">@feedback.CreatedAt.ToString("MMM dd, yyyy")</p>
                        </div>

                        <div class="flex items-center gap-1 mb-2">
                            @for (int i = 1; i <= 5; i++)
                            {
                                var color = i <= feedback.Rating ? "#facc15" : "#e5e7eb";
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"
                                     style="width: 20px; height: 20px; color: @color;">
                                    <path d="M9.049 2.927a1 1 0 011.902 0l1.286 3.975h4.18a1 1 0 01.592 1.806l-3.388
                                            2.46 1.287 3.974a1 1 0 01-1.538 1.117L10 13.347l-3.369
                                            2.912a1 1 0 01-1.538-1.117l1.287-3.974-3.388-2.46a1
                                            1 0 01.592-1.806h4.18L9.05 2.927z" />
                                </svg>
                            }
                        </div>

                        <p class="text-gray-700 italic">“@feedback.Comment”</p>
                    </div>
                </div>
            }
        </div>

        <!-- PHÂN TRANG -->
        <div class="flex flex-wrap justify-between items-center mt-10 border-t pt-4">
            <!-- Nút Previous -->
            @if (Model.FeedbackResult.HasPreviousPage)
            {
                <a asp-page="/FeedbackFull"
                   asp-route-currentPage="@(Model.FeedbackResult.Page - 1)"
                   asp-route-pageSize="@Model.FeedbackResult.PageSize"
                   class="btn btn-sm btn-outline">«</a>
            }
            else
            {
                <button class="btn btn-sm btn-outline" disabled>«</button>
            }

            <!-- Số trang hiện tại -->
            <span class="text-sm text-gray-600">Trang <b>@Model.FeedbackResult.Page</b> / @Model.FeedbackResult.TotalPages</span>

            <!-- Nút Next -->
            @if (Model.FeedbackResult.HasNextPage)
            {
                <a asp-page="/FeedbackFull"
                   asp-route-currentPage="@(Model.FeedbackResult.Page + 1)"
                   asp-route-pageSize="@Model.FeedbackResult.PageSize"
                   class="btn btn-sm btn-outline">»</a>
            }
            else
            {
                <button class="btn btn-sm btn-outline" disabled>»</button>
            }

            <!-- Chọn số lượng trên mỗi trang -->
            <div class="ml-auto mb-4">
                <label for="pageSizeSelect" class="text-sm text-gray-600 mr-2">Hiển thị:</label>
                <select id="pageSizeSelect"
                        class="select select-sm border border-gray-300 rounded-md"
                        onchange="location.href='@Url.Page("/FeedbackFull", new { currentPage = 1 })&pageSize=' + this.value">
                    @{
                        int currentSize = Model.FeedbackResult.PageSize;
                    }
                    <option value="5" selected="@(currentSize == 5)">5</option>
                    <option value="10" selected="@(currentSize == 10)">10</option>
                    <option value="20" selected="@(currentSize == 20)">20</option>
                    <option value="50" selected="@(currentSize == 50)">50</option>
                </select>
            </div>
        </div>
    }
</div>
