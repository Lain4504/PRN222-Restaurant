@page "/test-calculation"
@model PRN222_Restaurant.Pages.TestCalculationModel
@{
    ViewData["Title"] = "Test Point Calculation";
    Layout = "~/Pages/Shared/_FrontLayout.cshtml";
}

<div class="container mx-auto px-4 py-8 pt-24">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Test Point Calculation</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Current Config -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-primary">Current Configuration</h2>
                    <div class="space-y-2">
                        <p><strong>Points Per VND:</strong> @Model.Config.PointsPerVND</p>
                        <p><strong>Point Value:</strong> @Model.Config.PointValue.ToString("N0") VNĐ</p>
                        <p><strong>Min Order Amount:</strong> @Model.Config.MinimumOrderAmount.ToString("N0") VNĐ</p>
                        <p><strong>Max Usage %:</strong> @((Model.Config.MaxPointsUsagePercentage * 100).ToString("0.0"))%</p>
                        <p><strong>Welcome Bonus:</strong> @Model.Config.WelcomeBonusPoints points</p>
                    </div>
                </div>
            </div>

            <!-- Calculation Examples -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-secondary">Calculation Examples</h2>
                    <div class="space-y-4">
                        @foreach (var example in Model.Examples)
                        {
                            <div class="border border-base-300 rounded-lg p-3">
                                <p><strong>Order:</strong> @example.OrderAmount.ToString("N0") VNĐ</p>
                                <p><strong>Points Earned:</strong> @example.PointsEarned points</p>
                                <p><strong>Point Value:</strong> @example.PointValue.ToString("N0") VNĐ</p>
                                <p><strong>Return Rate:</strong> @example.ReturnRate.ToString("0.00")%</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Calculation -->
        <div class="card bg-base-100 shadow-xl mt-6">
            <div class="card-body">
                <h2 class="card-title text-accent">Detailed Calculation Formula</h2>
                <div class="space-y-4">
                    <div class="bg-base-200 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">Points Earning:</h3>
                        <p>Points = Math.Floor(Order Amount × @Model.Config.PointsPerVND)</p>
                        <p class="text-sm text-base-content/70">Example: 500,000 VNĐ × @Model.Config.PointsPerVND = @((500000 * Model.Config.PointsPerVND).ToString("0.00")) → @((int)Math.Floor(500000 * Model.Config.PointsPerVND)) points</p>
                    </div>
                    
                    <div class="bg-base-200 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">Point Value:</h3>
                        <p>1 point = @Model.Config.PointValue.ToString("N0") VNĐ</p>
                        <p class="text-sm text-base-content/70">Example: @((int)Math.Floor(500000 * Model.Config.PointsPerVND)) points = @(((int)Math.Floor(500000 * Model.Config.PointsPerVND) * Model.Config.PointValue).ToString("N0")) VNĐ value</p>
                    </div>
                    
                    <div class="bg-base-200 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">Return Rate:</h3>
                        <p>Return Rate = (Points × Point Value) / Order Amount × 100%</p>
                        <p class="text-sm text-base-content/70">Example: (@(((int)Math.Floor(500000 * Model.Config.PointsPerVND) * Model.Config.PointValue).ToString("N0")) VNĐ / 500,000 VNĐ) × 100% = @(((int)Math.Floor(500000 * Model.Config.PointsPerVND) * Model.Config.PointValue / 500000 * 100).ToString("0.00"))%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Deposit Calculation -->
        <div class="card bg-base-100 shadow-xl mt-6">
            <div class="card-body">
                <h2 class="card-title text-warning">Deposit Calculation (20%)</h2>
                <div class="overflow-x-auto">
                    <table class="table table-zebra">
                        <thead>
                            <tr>
                                <th>Order Total</th>
                                <th>Deposit (20%)</th>
                                <th>Remaining (80%)</th>
                                <th>Points Earned</th>
                                <th>Point Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var example in Model.Examples)
                            {
                                <tr>
                                    <td>@example.OrderAmount.ToString("N0") VNĐ</td>
                                    <td>@((example.OrderAmount * 0.2m).ToString("N0")) VNĐ</td>
                                    <td>@((example.OrderAmount * 0.8m).ToString("N0")) VNĐ</td>
                                    <td>@example.PointsEarned points</td>
                                    <td>@example.PointValue.ToString("N0") VNĐ</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
